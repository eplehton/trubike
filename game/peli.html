<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link type="text/css" rel="stylesheet" href="pyora.css" />
	<title> Peli </title>
	
	<script language="javascript" type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="clipsets.js"></script>
    <script type="text/javascript" src="js/peli.js"></script>
    <script type="text/javascript" src="js/kirjautuminen.js"></script>
    <script language="javascript" type="text/javascript">
        $(document).ready(function(){	
        
            // load clipsets to var clipsets with ajax call from a separate file
            //loadClipsets();
            // FIXME: due to asynchronous nature of this operation, it would be more correct to wait until the
            // call completes, before proceding. no we just hope everything is ready before the user clicks to 
            // start the video
            
            
            $("#instruction").click(function(){ /* kun alun ohjeruutua klikkaa, soitetaan eka video ja piilotetaan ohjeruutu */
                var instr = document.getElementById("instruction")
                instr.style.display = "none"; 
                console.log("Aloitetaan toisto")
                startVideo(); 
            }); 
                //showPoints();

            $("#klipinloppu").click(function(){/* kun klipinloppua klikkaa, soitetaan seuraava video ja piilotetaan klipinloppu-ruutu */
                console.log("Seuraava video")  
                var elem = document.getElementById("klipinloppu")
                elem.style.display = "none"; 			
                startVideo();		
            });
            
            // set check for missed targets
            var vplayer = document.getElementById("videoplayer");
            var check_missed_targets_interval_id = null;
            
            vplayer.addEventListener("playing", function() {
                if (check_missed_targets_interval_id == null) { // do not make duplicates
                    var all_targets = loadLocalTargets(); // this should not be done everytime, cache       
                    var trgs = getSourceTargets(all_targets, vplayer.src);
                    check_missed_targets_interval_id = setInterval( function(){ checkMissedTargets(trgs) },
                                                                             check_missed_target_interval_size); 
                    }
            });
        
            vplayer.addEventListener("pause", function() {
                clearInterval(check_missed_targets_interval_id);
                check_missed_targets_interval_id = null;
            });                
            
        });
    </script>

</head>

<body>
    <a id="stop" href="index.html" class="btn btn-large">Keskeytä peli
    </a>
    
    <div id="pisteruutu">PISTEET: 
    </div>

    <div class="ohjeruutu" id="instruction">
        <p> Tämä on ohjeruutu jossa sinulle annetaan ohjeita pelistä. Tässä pelissä sinun täytyy tehdä sitä ja tätä bla bla. Klikkaa jostakin kohtaa tätä ruutua aloittaaksesi pelin. 
        </p>
    </div>

    <div class="ohjeruutu hidden" id="klipinloppu">
        <p> Hienoa! Selvisit ensimmäisestä klipistä. Sait näin ja näin monta pistettä! Jatka klikkaamalla tätä ruutua </p>
    </div>

    <a href="index.html">
        <div class="ohjeruutu hidden" id="tasonloppu">
            <p> Hienoa! Selvisit ensimmäisestä tasosta. Sait näin ja näin monta pistettä! Jatka seuraavalle tasolle klikkaamalla tätä ruutua. </p>
        </div>
    </a>

    <div>
        <video id="videoplayer" onclick=videoClicked(event)
            muted
            onended=videoEnded(event)
            src="">
        </video> 
    
    
        <div id="hitpoint_tmpl" class="hitpoint"></div>
        <div id="missed_target" onclick="acknowledgeMissedTarget()"></div>
    </div>
   
    <audio id="targethitplayer" src="media/targethit.mp3"></audio>
    
    
</body>
</html>