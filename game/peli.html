<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link type="text/css" rel="stylesheet" href="pyora.css" />
	<title> Peli </title>
	
	<script language="javascript" type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="clipsets.js"></script>
    <script type="text/javascript" src="js/peli.js"></script>
    <script type="text/javascript" src="js/kirjautuminen.js"></script>
    <script language="javascript" type="text/javascript">
        $(document).ready(function(){	
        
            // load clipsets to var clipsets with ajax call from a separate file
            //loadClipsets();
            // FIXME: due to asynchronous nature of this operation, it would be more correct to wait until the
            // call completes, before proceding. no we just hope everything is ready before the user clicks to 
            // start the video
            
            
            $("#instruction").click(function(){ /* kun alun ohjeruutua klikkaa, soitetaan eka video ja piilotetaan ohjeruutu */
                var instr = document.getElementById("instruction")
                instr.style.display = "none"; 
                console.log("Aloitetaan toisto")
                startVideo(); 
            }); 
                //showPoints();

            $("#klipinloppu").click(function(){/* kun klipinloppua klikkaa, soitetaan seuraava video ja piilotetaan klipinloppu-ruutu */
                console.log("Seuraava video")  
                var elem = document.getElementById("klipinloppu")
                elem.style.display = "none"; 			
                startVideo();		
            });
            
            // set check for missed targets
            var vplayer = document.getElementById("videoplayer");
            var check_missed_targets_interval_id = null;
            
            vplayer.addEventListener("playing", function() {
                if (check_missed_targets_interval_id == null) { // do not make duplicates
                    var all_targets = loadLocalTargets(); // this should not be done everytime, cache       
                    var trgs = getSourceTargets(all_targets, vplayer.src);
                    check_missed_targets_interval_id = setInterval( function(){ checkMissedTargets(trgs) },
                                                                             check_missed_target_interval_size); 
                    }
            });
        
            vplayer.addEventListener("pause", function() {
                clearInterval(check_missed_targets_interval_id);
                check_missed_targets_interval_id = null;
            });                
            
        });
    </script>

</head>

<body>
    <a id="stop" href="index.html" class="btn btn-large">Keskeytä peli
    </a>
    
    <div id="pisteruutu">PISTEET: 
    </div>

    <div class="ohjeruutu" id="instruction">
        <p>Pyöräillessä on hyvä varmistua siitä, ettei kukaan tule yllättäen eteen. Kun pystyy ennakoimaan,
     		ei joudu kolariin tai tekemään äkkijarrutusta. 
		   Etsi liikenteestä autoja tai muita tiellä kulkijoita, jotka ovat tulossa eteesi ja klikkaa niitä. 
		   Hyvistä havainnoista saat pisteitä.</p> 
		   
		   <p>Klikkaa tätä ruutua aloittaaksesi pelin. </p>
    </div>

    <div class="ohjeruutu hidden" id="klipinloppu">
        <p> Jatka seuraavaan videoon klikkaamalla tätä ruutua. </p>
    </div>

    <a href="index.html">
        <div class="ohjeruutu hidden" id="tasonloppu">
            <p> Hienoa! Pääsit tasosta läpi. Palaa valikkoon klikkaamalla tätä ruutua. </p>
        </div>
    </a>

    <div style="text-align: center; vertical-align: middle;" >
        <video id="videoplayer" 
		    onclick="videoClicked(event)"
            onended="videoEnded(event)"
            src=""
			muted>
        </video> 
    
    
        <div id="hitpoint_tmpl" class="hitpoint"></div>
        <div id="missed_target" onclick="acknowledgeMissedTarget()"></div>
    </div>
   
    <audio id="targethitplayer" src="media/targethit.mp3"></audio>
    <audio id="missplayer" src="media/188039__antumdeluge__bicycle-horn.wav"></audio>

    
    
</body>
</html>